<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Course Details - RaidServices</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<nav class="nav">
  <div class="brand">‚ö° RaidServices</div>

  <div class="nav-right">
    <a href="index.html">Home</a>
    <a href="courses_projects.html" class="active">Courses/Projects</a>
    <a href="chatbot.html">üí¨ Chatbot</a>

    <a id="adminLink" href="admin.html" style="display:none">Admin Panel</a>

    <button id="cartBtn" class="btn cartBtn" onclick="location.href='cart.html'" style="display:none">
      üõí <span id="cartCount" style="font-size:0.8rem">(0)</span>
    </button>

    <div id="profileBox" class="profile" style="display:none">
      <img id="profilePic" class="avatar" alt="profile">
      <div class="dropdown">
        <a href="profile.html">Profile</a>
        <a href="settings.html">Settings</a>
        <a href="#" onclick="logout()">Logout</a>
      </div>
    </div>

    <a id="loginLink" href="login.html">Login</a>
    <a id="registerLink" href="register.html">Register</a>
  </div>
</nav>

<main class="page" style="max-width: 1000px; margin: 0 auto;">
  <div id="courseDetail" style="width: 100%;"></div>
</main>

<footer class="footer">
  ¬© 2026 - ‚ö° RaidServices
</footer>

<script type="module">
import { db } from "./firebase.js";
import { doc, getDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import { Toast } from "./utils.js";

const params = new URLSearchParams(window.location.search);
const courseId = params.get('id');
const courseKey = params.get('course'); // fallback for local/sample courses
const detailContainer = document.getElementById('courseDetail');

async function loadCourseDetail() {
  if (!courseId) {
    detailContainer.innerHTML = '<p style="text-align:center; color: var(--muted);">Course not found</p>';
    return;
  }

  try {
    let course = null;

    // If a Firestore id is provided, try to load from db
    if (courseId) {
      const snap = await getDoc(doc(db, "courses", courseId));
      if (!snap.exists()) {
        detailContainer.innerHTML = '<p style="text-align:center; color: var(--muted);">Course not found</p>';
        return;
      }
      course = snap.data();
    } else if (courseKey) {
      // Local sample data for quick view (when using combined page)
      const samples = {
        'web-dev': {
          title: 'Intro to Web Development',
          img: 'https://images.unsplash.com/photo-1515879218367-8466d910aaa4?w=1200&h=800&fit=crop',
          price: 19.99,
          desc: `Learn HTML, CSS and JavaScript to build modern responsive websites.\n\n‚Ä¢ Build responsive pages using modern CSS\n‚Ä¢ JavaScript basics, DOM and events\n‚Ä¢ Small projects: portfolio, landing pages\n‚ú® What you'll learn:\n‚Ä¢ HTML structure & semantics\n‚Ä¢ Styling with CSS and Flexbox/Grid\n‚Ä¢ Interactive pages with JavaScript\n\nüéØ Perfect for beginners` }
        , 'js-fundamentals': {
          title: 'JavaScript Fundamentals',
          img: 'https://images.unsplash.com/photo-1547658719-da2b51169166?w=1200&h=800&fit=crop',
          price: 24.99,
          desc: 'Deep dive into core JavaScript concepts: functions, closures, async programming, and DOM manipulation.\n\n‚Ä¢ ES6+ features\n‚Ä¢ Async/await and Promises\n‚Ä¢ DOM manipulation and events'
        },
        'firebase': {
          title: 'Firebase & Backend',
          img: 'https://images.unsplash.com/photo-1519389950473-47ba0277781c?w=1200&h=800&fit=crop',
          price: 29.99,
          desc: 'Build realtime apps using Firebase Authentication, Firestore, and Cloud Functions.\n\n‚Ä¢ Firestore data model\n‚Ä¢ Auth integration\n‚Ä¢ Deploying Cloud Functions'
        }
      };
      course = samples[courseKey] || samples['web-dev'];
    } else {
      detailContainer.innerHTML = '<p style="text-align:center; color: var(--muted);">No course specified</p>';
      return;
    }
    const description = course.desc || '';
    const lines = description.split('\n').filter(line => line.trim());

    detailContainer.innerHTML = `
      <div style="margin-top: 40px;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: start;">
          <div>
            <img src="${course.img}" alt="${course.title}" style="width: 100%; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);" onerror="this.src='https://via.placeholder.com/500x400?text=Course'">
          </div>
          <div>
            <h1 style="margin: 0 0 20px 0; font-size: 2.5rem; background: linear-gradient(135deg, #7c3aed, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">${course.title}</h1>
            
            <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 30px;">
              <div style="background: rgba(124, 58, 237, 0.2); padding: 15px 25px; border-radius: 10px; border: 1px solid var(--primary);">
                <h3 style="margin: 0 0 5px 0; color: var(--muted);">Price</h3>
                <p style="margin: 0; font-size: 2rem; color: var(--primary-light); font-weight: 700;">‚Ç¨${course.price.toFixed(2)}</p>
              </div>
            </div>

            <button class="btn primary full" onclick="addToCart('${courseId}')" style="padding: 16px; font-size: 1.1rem; margin-bottom: 10px;">üõí Add to Cart</button>
            <button class="btn secondary full" onclick="viewCourseProjects('${course.title}')" style="padding: 16px; font-size: 1.1rem; margin-bottom: 10px;">üìÅ View Projects</button>
            <a href="courses_projects.html" class="btn secondary full" style="text-decoration: none; text-align: center; padding: 16px; font-size: 1.1rem;">‚Üê Back to Courses/Projects</a>

            <div style="margin-top: 30px; padding-top: 30px; border-top: 1px solid var(--border);">
              <h3 style="font-size: 1.2rem; margin-top: 0;">Course Includes</h3>
              <ul style="list-style: none; padding: 0; margin: 0;">
                <li style="padding: 8px 0;">‚úì Video lessons & tutorials</li>
                <li style="padding: 8px 0;">‚úì Hands-on projects</li>
                <li style="padding: 8px 0;">‚úì Source code & resources</li>
                <li style="padding: 8px 0;">‚úì Certificate of completion</li>
                <li style="padding: 8px 0;">‚úì Lifetime access</li>
              </ul>
            </div>
          </div>
        </div>

        <div style="margin-top: 60px; padding: 40px; background: var(--card); border-radius: 15px; border: 1px solid var(--border);">
          <h2 style="margin-top: 0;">Course Overview</h2>
          ${lines.map(line => {
            if (line.startsWith('‚ú®') || line.startsWith('üéØ') || line.startsWith('‚è±Ô∏è') || line.startsWith('üìö')) {
              return `<p style="font-weight: 600; margin: 15px 0 10px 0; color: var(--primary);">${line}</p>`;
            } else if (line.startsWith('‚Ä¢')) {
              return `<li style="margin: 8px 0 8px 20px; color: var(--muted);">${line.substring(1).trim()}</li>`;
            }
            return `<p style="margin: 15px 0; line-height: 1.6; color: var(--text);">${line}</p>`;
          }).join('')}
        </div>
      </div>
    `;
  } catch (error) {
    console.error('Error loading course:', error);
    Toast.error("Error", "Failed to load course details");
  }
}

window.addToCart = (id) => {
  const cart = JSON.parse(localStorage.getItem("cart") || "[]");
  if (!cart.includes(id)) {
    cart.push(id);
    localStorage.setItem("cart", JSON.stringify(cart));
    const cartCount = document.getElementById("cartCount");
    if (cartCount) cartCount.innerText = `(${cart.length})`;
    Toast.success("Added to Cart!", "Course added successfully");
  } else {
    Toast.info("Already Added", "This course is already in your cart");
  }
};

window.viewCourseProjects = (courseName) => {
  // Map course names to course IDs for filtering
  const courseMap = {
    "Arduino Basics & IoT Projects": "arduino",
    "Raspberry Pi Mastery": "raspberrypi",
    "Python for IoT": "python",
    "Cybersecurity Essentials": "cybersecurity",
    "Web Development Bootcamp": "webdev"
  };
  
  const courseId = courseMap[courseName] || "all";
  window.location.href = `projects.html?course=${courseId}`;
};

loadCourseDetail();
</script>
<script src="cart-api.js"></script>
<script type="module" src="firebase.js"></script>
<script type="module" src="utils.js"></script>
<script type="module" src="auth.js"></script>
<script type="module" src="nav-auth.js"></script>

</body>
</html>
